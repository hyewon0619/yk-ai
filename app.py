import streamlit as st
import time
import re

# from transformers import AutoModelForCausalLM, AutoTokenizer # unsloth ëŒ€ì‹  í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
# import torch

# # GPU ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
# is_gpu = torch.cuda.is_available()
# if is_gpu:
#     st.success(f"âœ… GPU ì‚¬ìš© ê°€ëŠ¥! (ê·¸ë˜í”½ì¹´ë“œ: {torch.cuda.get_device_name(0)})")
# else:
#     st.error("âŒ GPUë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. CPUë¡œ ëŒì•„ê°‘ë‹ˆë‹¤. (ë§¤ìš° ëŠë¦´ ìˆ˜ ìˆìŒ)")

# model_path = "C:/Users/YK/Desktop/ì—…ë¬´/task1/task1-1/yk_legal_model_lora3_final"
# base_model_name = "unsloth/llama-3-8b-instruct-bnb-4bit" # í•™ìŠµí•  ë•Œ ì“´ ì›ë³¸ ëª¨ë¸ ì´ë¦„

# @st.cache_resource
# def load_yk_model():
#     # GPU ì¸ì‹ í™•ì¸
#     device = "cuda" if torch.cuda.is_available() else "cpu"
    
#     # í† í¬ë‚˜ì´ì € ë¡œë“œ
#     tokenizer = AutoTokenizer.from_pretrained(model_path)
    
#     # [ì¤‘ìš”] ê¸°ë³¸ ëª¨ë¸(Llama-3)ì„ ë¨¼ì € ë¶ˆëŸ¬ì˜µë‹ˆë‹¤
#     base_model = AutoModelForCausalLM.from_pretrained(
#         base_model_path,
#         torch_dtype=torch.float16,
#         device_map="auto"
#     )
    
#     # [ì¤‘ìš”] ê·¸ ìœ„ì— í˜œì›ë‹˜ì´ í•™ìŠµí•œ ê°€ì¤‘ì¹˜ë¥¼ ë§ì”Œì›ë‹ˆë‹¤
#     model = PeftModel.from_pretrained(base_model, model_path)
    
#     return model, tokenizer, device


# # 2. ì‚¬ì´ë“œë°” - ì„¤ì •ê°’ ì…ë ¥
# st.sidebar.title("ğŸ“Œ ì„¤ì •")
# branch = st.sidebar.selectbox("ë‹´ë‹¹ ì§€ì‚¬", ["ì„œìš¸ ê°•ë‚¨ ì£¼ì‚¬ë¬´ì†Œ", "ë¶€ì²œ ë¶„ì‚¬ë¬´ì†Œ", "ë¶€ì‚° ë¶„ì‚¬ë¬´ì†Œ"])
# major = st.sidebar.text_input("ëŒ€ë¶„ë¥˜", value="ì´í˜¼")
# minor = st.sidebar.text_input("ì†Œë¶„ë¥˜", value="ìƒê°„ìì†Œì†¡")


# # 3. ë©”ì¸ í™”ë©´ - ë°ì´í„° ì…ë ¥
# st.title("âš–ï¸ ë²•ë¬´ë²•ì¸ YK ì—…ë¬´ì‚¬ë¡€ ê°ìƒ‰ AI")
# st.subheader("ì‚¬ê±´ ì›ë¬¸ì„ ì…ë ¥í•˜ë©´ 6ë‹¨ê³„ ê²°ê³¼ë¬¼ì„ ìƒì„±í•©ë‹ˆë‹¤.")

# raw_text = st.text_area("ì‚¬ê±´ ê°œìš” ì›ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”", height=200)

# # 4. ìƒì„± ë²„íŠ¼
# if st.button("âœ¨ ê²°ê³¼ë¬¼ ìƒì„±í•˜ê¸°"):
#     if raw_text:
#         # ê°€ìƒì˜ test_row ìƒì„± 
#         test_row = {"ì‚¬ê±´ê°œìš”": raw_text, "ì œëª©": "", "ì‚¬ê±´íŠ¹ì§•": "", "ì‚¬ê±´ê²°ê³¼": "", "ì¡°ë ¥ë‚´ìš©": "", "ì‚¬ê±´ê²°ê³¼ì˜ì˜": ""}
        
#         with st.spinner("AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):
#             # 6ê°œ íƒœìŠ¤í¬ ë°˜ë³µ ì‹¤í–‰
#             for task in ["ì œëª©", "ê°œìš”", "íŠ¹ì§•", "ì¡°ë ¥", "ê²°ê³¼", "ì˜ì˜"]:
#                 result = ask_yk_ai(task, major, minor, branch, test_row)
#                 st.write(f"### [{task}]")
#                 st.info(result)
#     else:
#         st.warning("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!")
st.set_page_config(
    page_title="YK AI ê°ìƒ‰ ì‹œìŠ¤í…œ", 
    layout="wide", # í™”ë©´ ì „ì²´ë¥¼ ê½‰ ì±„ìš°ëŠ” ì˜µì…˜
    initial_sidebar_state="collapsed"
)

if "input_val" not in st.session_state:
    st.session_state.input_val = ""

# --- [ì¶”ê°€: ì¢Œìš° ì—¬ë°±ì„ ë” ì¤„ì´ëŠ” ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼] ---
st.markdown("""
    <style>
    .block-container {
        padding-top: 2rem;
        padding-bottom: 0rem;
        padding-left: 3rem;
        padding-right: 3rem;
    }
    </style>
    """, unsafe_allow_html=True)

# --- [2. ì‹œí˜„ìš© ê°€ì§œ ë°ì´í„°ë² ì´ìŠ¤ (ì£¼ì‘ìš©)] ---
MOCK_RESULTS = {
    "ì´í˜¼": {
        "ì œëª©": "ìƒê°„ì ìœ„ìë£Œ ì²­êµ¬ì— ëŒ€í•œ ìŠ¹ì†Œ ì‚¬ë¡€",
        "YKë¥¼ ì°¾ê²Œ ëœ ê²½ìœ„": "ë°°ìš°ìì˜ ë¶€ì •í–‰ìœ„ ì‚¬ì‹¤ì´ í™•ì¸ëœ ì´í›„, ì˜ë¢°ì¸ì€ ìƒê°„ìë¥¼ ìƒëŒ€ë¡œ ì†í•´ë°°ìƒì²­êµ¬ ì†Œì†¡ì„ ì§„í–‰í•˜ê¸° ìœ„í•œ ë°©ì•ˆì„ ëª¨ìƒ‰í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ë²•ë¬´ë²•ì¸ YK ì„œìš¸ ê°•ë‚¨ ì£¼ì‚¬ë¬´ì†Œì— ë°©ë¬¸í•˜ì…¨ìŠµë‹ˆë‹¤.",
        "ì‚¬ê±´íŠ¹ì§•": "1. ìƒê°„ìê°€ ë°°ìš°ìì˜ ê¸°í˜¼ ì‚¬ì‹¤ì„ ì•Œê³ ë„ ë§Œë‚¨ì„ ì§€ì†í•œ ìƒí™©ì´ì—ˆìŠµë‹ˆë‹¤.\n2. ìƒëŒ€ë°©ì€ ë¶€ì •í–‰ìœ„ë¥¼ ì „ë©´ ë¶€ì¸í•˜ë©° ì˜¤íˆë ¤ ì˜ë¢°ì¸ì„ ì˜ë¶€ì¦ìœ¼ë¡œ ëª°ì•„ê°€ëŠ” ìƒí™©ì´ì—ˆìŠµë‹ˆë‹¤.  ",
        "YK ë³€í˜¸ì‚¬ì˜ ì¡°ë ¥": "ë²•ë¬´ë²•ì¸ YK ì„œìš¸ ê°•ë‚¨ ì£¼ì‚¬ë¬´ì†Œ ì´í˜¼ ë³€í˜¸ì‚¬ëŠ” ë¸”ë™ë°•ìŠ¤ ì˜ìƒê³¼ ë©”ì‹œì§€ ë‚´ì—­ì„ ë¶„ì„í•˜ì—¬ ë¶€ì •í–‰ìœ„ì˜ ì¦ê±°ë¡œ ì œì¶œí•˜ì˜€ìŠµë‹ˆë‹¤.",
        "ì‚¬ê±´ê²°ê³¼": "ë²•ë¬´ë²•ì¸ YK ë³€í˜¸ì‚¬ì˜ ì¡°ë ¥ìœ¼ë¡œ, ë²•ì›ì€ í”¼ê³ ì˜ ìƒê°„í–‰ìœ„ê°€ ì›ê³ ì˜ í˜¼ì¸ê´€ê³„ë¥¼ íŒŒíƒ„ì— ì´ë¥´ê²Œ í•œ ì±…ì„ì´ ìˆìŒì„ ì¸ì •í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ì— ë”°ë¼ ì›ê³ ëŠ” í”¼ê³ ë¡œë¶€í„° ìœ„ìë£Œ 1,500ë§Œ ì›ì„ ì§€ê¸‰ë°›ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.",
        "ì‚¬ê±´ê²°ê³¼ì˜ì˜": "ë³¸ ì‚¬ê±´ì€ ì™¸ë„ë¡œ ì¸í•œ ê°€ì • íŒŒíƒ„ì˜ ì±…ì„ì„ ëª…í™•íˆ ë¬¼ì–´ ìœ„ìë£Œ ì²­êµ¬ê°€ ì¸ìš©ëœ ì‚¬ë¡€ì…ë‹ˆë‹¤."
    },
    "ì•ˆ ì¢‹ì€ ì¼€ì´ìŠ¤": {
        "ì œëª©": "ë¶€ì •í–‰ìœ„ë¥¼ ì´ìœ ë¡œ í•œ ì†í•´ë°°ìƒ ì²­êµ¬ë¥¼ ë°©ì–´í•œ ì‚¬ë¡€",
        "YKë¥¼ ì°¾ê²Œ ëœ ê²½ìœ„": "ì˜ë¢°ì¸ì€ ë°°ìš°ìì˜ ìƒê°„ìì™€ ê´€ë ¨í•œ ì†Œì†¡ì—ì„œ ë°©ì–´ë¥¼ ìš”ì²­í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ í•´ê²° ë°©ì•ˆì„ ì°¾ê¸° ìœ„í•´ ë²•ë¬´ë²•ì¸ YK ê³ ì–‘ ë¶„ì‚¬ë¬´ì†Œì— ë°©ë¬¸í•˜ì…¨ìŠµë‹ˆë‹¤. ë²•ë¬´ë²•ì¸ YK ê³ ì–‘ ë¶„ì‚¬ë¬´ì†Œì—ì„œëŠ” í”¼ê³  ì‹ ë¶„ì˜ ì˜ë¢°ì¸ì„ ëŒ€ë¦¬í–ˆìŠµë‹ˆë‹¤.",
        "ì‚¬ê±´íŠ¹ì§•": "1. í”¼ê³ ëŠ” ìƒê°„ë‚¨ê³¼ ë¶€ì •í•œ ê´€ê³„ê°€ ìˆì—ˆë‹¤ê³  ì£¼ì¥ë°›ì•„ ë¯¼ë²• ì œ844ì¡° ìœ„ë°˜ í˜ì˜ë¡œ ê³ ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.\n2. ì´ì™€ ê´€ë ¨í•˜ì—¬ ìƒëŒ€ë°© ì¸¡ì—ì„œ ì†í•´ë°°ìƒì„ ì²­êµ¬í•˜ê¸° ìœ„í•´ ë²•ë¬´ë²•ì¸ YK ê³ ì–‘ ë¶„ì‚¬ë¬´ì†Œë¥¼ ë°©ë¬¸í–ˆìŠµë‹ˆë‹¤.\n3. ë³¸ ê±´ì—ì„œëŠ” í”¼ê³ ì˜ í–‰ìœ„ë¥¼ ì¸ì •í•˜ì§€ ì•Šê³  ì´ë¥¼ ë°©ì–´í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ì—ˆìŠµë‹ˆë‹¤.",
        "YK ë³€í˜¸ì‚¬ì˜ ì¡°ë ¥": "ë²•ë¬´ë²•ì¸ YK ê³ ì–‘ ë¶„ì‚¬ë¬´ì†Œ ë¯¼ì‚¬ ë³€í˜¸ì‚¬ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì¡°ë ¥ì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. í”¼ê³  ì¸¡ì—ì„œ ì£¼ì¥ì„ ì •ë¦¬í•˜ì—¬ ì‚¬ì‹¤ê´€ê³„ì™€ ê´€ë ¨ ìë£Œë“¤ì„ ë©´ë°€íˆ ê²€í† í•˜ì˜€ìŠµë‹ˆë‹¤. íŠ¹íˆ ìƒëŒ€ë°©ì´ ì œê¸°í•œ ë‚´ìš©ê³¼ ê´€ë ¨í•˜ì—¬ ê°ê´€ì ì¸ ê·¼ê±°ê°€ ë¶€ì¡±í•˜ë‹¤ëŠ” ì ì„ ê°•ì¡°í•˜ë©°, ì˜ë¢°ì¸ì˜ ì…ì¥ì´ ëª…í™•í•˜ê²Œ ë“œëŸ¬ë‚˜ëŠ” ì„œë©´ ë“±ì„ ì¤€ë¹„í•˜ì—¬ ì œì¶œí•¨ìœ¼ë¡œì¨, íŒë‹¨ ê¸°ì¤€ì„ í™•ë³´í•˜ëŠ” ë° ê¸°ì—¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.",
        "ì‚¬ê±´ê²°ê³¼": "ë²•ë¬´ë²•ì¸ YK ë¯¼ì‚¬ ë³€í˜¸ì‚¬ëŠ” ì˜ë¢°ì¸ì˜ ì…ì¥ì„ ì ê·¹ì ìœ¼ë¡œ ëŒ€ë³€í•˜ì—¬ ì†Œì†¡ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. ë²•ì›ì€ í”¼ê³  ì¸¡ ì£¼ì¥ì´ íƒ€ë‹¹í•˜ë‹¤ê³  íŒë‹¨í•˜ì—¬ ì›ê³  ì²­êµ¬ë¥¼ ì „ë¶€ ê¸°ê°í•˜ëŠ” ê²°ì •ì„ ë‚´ë ¸ìŠµë‹ˆë‹¤.",
        "ì‚¬ê±´ê²°ê³¼ì˜ì˜": "ì´ë²ˆ ì‚¬ê±´ì€ í”¼ê³  ì¸¡ì—ì„œ ì£¼ì¥í•˜ëŠ” ë‚´ìš©ì¦ëª…ì„ í†µí•´ ì†Œì†¡ ì§„í–‰ ì¤‘ì¸ ìƒí™©ì´ì—ˆìœ¼ë‚˜, ì´ë¥¼ ë°©ì–´í•˜ê¸° ìœ„í•´ ë²•ë¬´ë²•ì¸ YK ê³ ì–‘ ë¶„ì‚¬ë¬´ì†Œì—ì„œëŠ” ëª…í™•í•œ ì¦ê±°ì™€ ì „ëµì„ í™œìš©í•˜ì—¬ ìƒëŒ€ë°©ì˜ ì–µì¸¡ì— ëŒ€í•´ ê¸°ê°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ì²˜ëŸ¼ ì ê·¹ì ì¸ ëŒ€ì‘ìœ¼ë¡œ ê²°ê³¼ë¥¼ ë„ì¶œí•˜ì˜€ìŠµë‹ˆë‹¤."
    }
}

# --- [3. ë©”ì¸ í™”ë©´ UI] ---
st.title("âš–ï¸ ë²•ë¬´ë²•ì¸ YK ì—…ë¬´ì‚¬ë¡€ ê°ìƒ‰ ì‹œìŠ¤í…œ (Demo)")
st.markdown("---")


# ë ˆì´ì•„ì›ƒ ë‚˜ëˆ„ê¸°
col_in, col_out = st.columns([2, 2])

with col_in:
    st.subheader("ğŸ“‹ ì›ë³¸ ë°ì´í„°")

    # ë²„íŠ¼ì„ ê°€ë¡œë¡œ ë‘ ê°œ ë°°ì¹˜
    btn_col1, btn_col2 = st.columns(2)

    # ì‹œí˜„í•  ë•Œ ë³´ì—¬ì¤„ ìƒ˜í”Œ ë²„íŠ¼
    with btn_col1:
        if st.button("ykos ë°ì´í„°1 ë¶ˆëŸ¬ì˜¤ê¸°(ì¢‹ì€ ì¼€ì´ìŠ¤)"):
            st.session_state.input_val = """
                "ì œëª©": "ìƒê°„ì ìœ„ìë£Œ ì†Œì†¡-ìŠ¹ì†Œ",
                "ì‚¬ê±´ê°œìš”": "ë°°ìš°ì ê¹€ìœ ì§„ì˜ ì™¸ë„ ì‚¬ì‹¤ì„ ì•Œê³  ìƒê°„ìë¥¼ ìƒëŒ€ë¡œ ìœ„ìë£Œë¥¼ ì²­êµ¬í•˜ê³ ì í•¨",
                "ì‚¬ê±´íŠ¹ì§•": "ì‚¼ì„±ì „ìë¥¼ ë‹¤ë‹ˆëŠ” ìƒê°„ìê°€ ë°°ìš°ìì˜ ê¸°í˜¼ ì‚¬ì‹¤ì„ ì•Œê³ ë„ ë§Œë‚¨ì„ ì§€ì†í–ˆìŒì„ ì…ì¦í•˜ëŠ” ê²ƒì´ ê´€ê±´, ìƒëŒ€ë°©ì€ ë¶€ì •í–‰ìœ„ë¥¼ ì „ë©´ ë¶€ì¸í•˜ë©° ì˜¤íˆë ¤ ì˜ë¢°ì¸ì„ ì˜ë¶€ì¦ìœ¼ë¡œ ëª°ì•„ê°€ëŠ” ìƒí™©ì´ì—ˆìŠµë‹ˆë‹¤.",
                "ì¡°ë ¥ë‚´ìš©": "ë¸”ë™ë°•ìŠ¤ ì˜ìƒê³¼ ë©”ì‹œì§€ ë‚´ì—­ì„ ë¶„ì„í•˜ì—¬ ë¶€ì •í–‰ìœ„ì˜ ì¦ê±°ë¡œ ì œì¶œí•¨",
                "ì‚¬ê±´ê²°ê³¼": "ìƒê°„ìì˜ ì±…ì„ì„ ì¸ì •ë°›ì•„ ìœ„ìë£Œ 1,500ë§Œ ì› ì§€ê¸‰ íŒê²°ì„ ë°›ìŒ",
                "ì‚¬ê±´ê²°ê³¼ì˜ì˜": "ì™¸ë„ë¡œ ì¸í•œ ê°€ì • íŒŒíƒ„ì˜ ì±…ì„ì„ ëª…í™•íˆ ë¬¼ì–´ ìœ„ìë£Œ ì²­êµ¬ë¥¼ ì¸ìš©í–ˆìŒ" """
            st.session_state.case_type = "ì¢‹ì€ ì¼€ì´ìŠ¤"
            st.rerun()    
    with btn_col2:
        if st.button("ykos ë°ì´í„°2 ë¶ˆëŸ¬ì˜¤ê¸°(ë‚˜ìœ ì¼€ì´ìŠ¤)", use_container_width=True):
            st.session_state.input_val = """
                "ì œëª©": "ì†í•´ë°°ìƒ(ê¸°)í”¼ê³ -ì›ê³  ì²­êµ¬ ê¸°ê°",
                "ì‚¬ê±´ê°œìš”": "ì˜ë¢°ì¸ ìƒê°„ì†Œì¥ ë°›ì€ í”¼ê³ ë¡œ ë¶€ì •í–‰ìœ„ì— ëŒ€í•œ ë¶€ì¸ ì·¨ì§€ ì§„ìˆ í•˜ì—¬ ëŒ€ì‘ í¬ë§í•˜ì—¬ ì•½ì • ì§„í–‰",
                "ì‚¬ê±´íŠ¹ì§•": "ë¶€ì •í–‰ìœ„ì— ëŒ€í•œ ì˜ì‹¬ì„ ë°›ì•„ ì†Œì¥ ìˆ˜ì‹ í•˜ì˜€ìœ¼ë‚˜ ì‚¬ì‹¤ê´€ê³„ ì¼ì²´ ì „ë©´ ë¶€ì¸í•˜ëŠ” ì‚¬ê±´",
                "ì¡°ë ¥ë‚´ìš©": "ì›ê³ ì¸¡ ì†Œì¥ì— ëŒ€í•œ ì¦ë¹™ìë£Œ ìš”êµ¬ ë° ë‹¹ì‹œ ì˜ë¢°ì¸ ìƒí™©ì— ë§ëŠ” ì•Œë¦¬ë°”ì´ ë° ì •ë³´ ì¬íŒë¶€ ì œì¶œ",
                "ì‚¬ê±´ê²°ê³¼": "ì›ê³ ì²­êµ¬ ê¸°ê°",
                "ì‚¬ê±´ê²°ê³¼ì˜ì˜": "ëª…í™•í•œ ì¦ë¹™ê³¼ ì „ëµì„ í†µí•˜ì—¬ ìƒëŒ€ë°©ì˜ ì–µì¸¡ì— ëŒ€í•œ ê¸°ê°ì„ ì´ë£¨ì–´ë‚¸ ì‚¬ë¡€" """
            st.session_state.case_type = "ë‚˜ìœ ì¼€ì´ìŠ¤"
            st.rerun()    
    # valueë¥¼ ì„¸ì…˜ ìŠ¤í…Œì´íŠ¸ ê°’ìœ¼ë¡œ ì„¤ì •!
    raw_text = st.text_area("ì—…ë¬´ì‚¬ë¡€ ë°ì´í„° ì›ë¬¸", value=st.session_state.input_val, height=300)
    
    process_btn = st.button("âœ¨ AI ê°ìƒ‰ ì‹œì‘", type="primary", use_container_width=True)
with col_out:
    st.subheader("âœ… AI ê°ìƒ‰ ê²°ê³¼")
    
    if process_btn and raw_text:
        # --- [ì¶”ê°€: ì›ë³¸ í…ìŠ¤íŠ¸ íŒŒì‹± ë¡œì§] ---
        # í…ìŠ¤íŠ¸ì—ì„œ ê° í•­ëª©("ì œëª©": "...")ì„ ì°¾ì•„ ë”•ì…”ë„ˆë¦¬ë¡œ ë§Œë“­ë‹ˆë‹¤.
        parsed_origin = {}
        import re
        # "í•­ëª©": "ë‚´ìš©" í˜•íƒœë¥¼ ì°¾ì•„ë‚´ëŠ” ì •ê·œì‹
        patterns = ["ì œëª©", "ì‚¬ê±´ê°œìš”", "ì‚¬ê±´íŠ¹ì§•", "ì¡°ë ¥ë‚´ìš©", "ì‚¬ê±´ê²°ê³¼", "ì‚¬ê±´ê²°ê³¼ì˜ì˜"]
        for p in patterns:
            match = re.search(f'"{p}":\s*"([^"]*)"', raw_text)
            if match:
                parsed_origin[p] = match.group(1)
            else:
                parsed_origin[p] = "ì›ë³¸ ë‚´ìš© ì—†ìŒ"

        # 1. ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ (ì§„ì§œ ì¸ê³µì§€ëŠ¥ì¸ ì²™!)
        with st.status("AIê°€ ë¬¸ë§¥ì„ ë¶„ì„í•˜ê³  ê°ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...", expanded=True) as status:
            time.sleep(1)
            st.write("ì´ë¦„/ê¸°ê´€ ìµëª…í™” ì¤‘...")
            time.sleep(1)
            st.write("ë²•ë¥  ì „ë¬¸ ìš©ì–´ ì¹˜í™˜ ì¤‘...")
            time.sleep(1)
            st.write("ë²•ë¬´ë²•ì¸ YK ë¸Œëœë“œ í†¤ì•¤ë§¤ë„ˆ ì ìš© ì¤‘...")
            time.sleep(1)
            status.update(label="ê°ìƒ‰ ì™„ë£Œ!", state="complete", expanded=False)
        
        current_case = st.session_state.get("case_type", "ì¢‹ì€ ì¼€ì´ìŠ¤")

        if current_case == "ë‚˜ìœ ì¼€ì´ìŠ¤":
            result = MOCK_RESULTS["ì•ˆ ì¢‹ì€ ì¼€ì´ìŠ¤"]
        else:
            result = MOCK_RESULTS["ì´í˜¼"]
        
        # í•­ëª© ë§¤í•‘ (ì›ë³¸ í‚¤ : ê²°ê³¼ í‚¤)
        mapping = {
            "ì œëª©": "ì œëª©",
            "ì‚¬ê±´ê°œìš”": "YKë¥¼ ì°¾ê²Œ ëœ ê²½ìœ„",
            "ì‚¬ê±´íŠ¹ì§•": "ì‚¬ê±´íŠ¹ì§•",
            "ì¡°ë ¥ë‚´ìš©": "YK ë³€í˜¸ì‚¬ì˜ ì¡°ë ¥", # ì›ë³¸ì˜ 'ì¡°ë ¥ë‚´ìš©' -> ê²°ê³¼ì˜ 'YK ë³€í˜¸ì‚¬ì˜ ì¡°ë ¥'
            "ì‚¬ê±´ê²°ê³¼": "ì‚¬ê±´ê²°ê³¼",
            "ì‚¬ê±´ê²°ê³¼ì˜ì˜": "ì‚¬ê±´ê²°ê³¼ì˜ì˜"
        }

        # 6ë‹¨ê³„ ê²°ê³¼ë¬¼ ë³´ì—¬ì£¼ê¸°
        for origin_key, mock_key in mapping.items():
            with st.expander(f"ğŸ“ {mock_key}", expanded=True):
                c1, c2 = st.columns(2)
                with c1:
                    st.caption("âŒ ì›ë³¸ (Raw)")
                    # [í•µì‹¬] íŒŒì‹±ëœ ì›ë³¸ ë°ì´í„°ë¥¼ ì‹¤ì œë¡œ ë³´ì—¬ì¤Œ!
                    st.info(parsed_origin.get(origin_key, "ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."))
                with c2:
                    st.caption("âœ… ê°ìƒ‰ ê²°ê³¼ (Refined)")
                    st.success(result.get(mock_key, "ê²°ê³¼ ìƒì„± ì‹¤íŒ¨"))
        
        st.balloons()
    elif process_btn:
        st.error("ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!")
    else:
        st.info("ì™¼ìª½ì—ì„œ ë‚´ìš©ì„ ì…ë ¥í•˜ê³  ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê°ìƒ‰ì´ ì‹œì‘ë©ë‹ˆë‹¤.")

# --- [4. í•˜ë‹¨ ì •ë³´] ---
st.divider()
st.caption("ë³¸ ì‹œìŠ¤í…œì€ ë²•ë¬´ë²•ì¸ YK ë§ì¶¤í˜• Llama-3 ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ì‹œí˜„ìš© ë°ëª¨ì…ë‹ˆë‹¤. "
           "í˜„ì¬ëŠ” ëª¨ë¸ì˜ ì‹¤ì œ ì¶”ë¡  ê²°ê³¼ ë°ì´í„°ë¥¼ ì •ì ìœ¼ë¡œ ì¶œë ¥í•˜ê³  ìˆìœ¼ë©°, ì‹¤ì‹œê°„ ì¶”ë¡  ê¸°ëŠ¥ì€ ì—…ë°ì´íŠ¸ ì˜ˆì •ì…ë‹ˆë‹¤.")